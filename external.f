C	DESIGN OF EXTERNAL EXPANSION PLUG NOZZLES
C	INPUT GAS=+1.0 WHEN DEALING WITH IDEAL GAS
C	INPUT GAS=-1.0 WHEN DEALING WITH REAL GAS
      DIMENSION HM(30),GAM(30)
101   READ 1,RM
      READ 1,GAS
1     FORMAT(F4.0)
      PRINT 47,RM
47    FORMAT(1H1,8HESTIMATE,1X,4HMACH,1X,6HNUMBER,1H=,F10.5)
      READ 2,XP,N
2     FORMAT(F10.0,I4)
      PRINT 102,XP
102   FORMAT(1HK,9HEXPANSION,1X,5HRATIO,1X,1H=,F10.5)
      READ 60,R,TE,PAPC,G
60    FORMAT(4F10.0)
      PRINT 51,R
51    FORMAT(1HK,3HGAS,1X,8HCONSTANT,1X,1H=,E14.7)
      PRINT 61,TE
61    FORMAT(1HK,4HEXIT,1X,11HTEMPERATURE,1X,1H=,E14.7)
      PRINT 53,PAPC
53    FORMAT(1HK,5HPA/PC,1X,1H=,E14.7)
      IF(GAS)4,4,10
10    READ 3,GAMA
3     FORMAT(F5.0)
      PRINT 45
45    FORMAT(1HK,5HUSING,1X,5HIDEAL,1X,3HGAS)
      PRINT 49,GAMA
49    FORMAT(1HK,1X,4HGAMA,1X,1H=,F5.2)
      GO TO 9

C	REAL GAS HAS TO INPUT NT VALUES OF THERMODYNAMIC DATA
4     READ 5,NT
5     FORMAT(I4)
      PRINT 46
46    FORMAT(1HK,5HUSING,1X,4HREAL,1X,3HGAS)
      DO 8 I=1,NT
        READ 6,HM(I),GAM(I)
6       FORMAT(2F10.7)
8     CONTINUE
9     CONTINUE
13    IF(GAS)30,31,31
30    DO 34 J=1,NT
        I=J
        IF(RM-HM(J))32,33,34
34    CONTINUE
33    GAMA=GAM(I)
      GO TO 31
32    GAMA=GAM(I-1)+(RM-HM(I-1))*(GAM(I)-GAM(I-1))/(HM(I)-HM(I-1))
31    FME=(2.0+(GAMA-1.0)*RM*RM)/(GAMA+1.0)
      COM=(GAMA+1.0)/(2.0*(GAMA-1.0))
      FME=RM*XP-FME**COM
      FPM=(2.0+(GAMA-1.0)*RM*RM)/(GAMA+1.0)
      COM=(3.0-GAMA)/(2.0*(GAMA-1.0))
      FPM=XP-RM*(FPM**COM)
      DM=-FME/FPM
      RM=RM+DM
      DM=ABS(DM)
      IF(DM-0.00001)12,12,13
12    CONTINUE
      A=SQRT((GAMA-1.0)*(RM*RM-1.0)/(GAMA+1.0))
      B=SQRT((GAMA+1.0)/(GAMA-1.0))
      C=SQRT(RM*RM-1.0)
      C=ATAN(C)
      VE=B*ATAN(A)-C
      DELTA=1.570796-VE
      SUMCG=((2.0/(GAMA+1.0))**(GAMA/(GAMA-1.)))*(GAMA+1.)*SIN(DELTA)
      HT=(XP-SQRT(XP*(XP-SIN(DELTA))))/(XP*SIN(DELTA))
      A1=(GAMA+1.0)/(2.0*(GAMA-1.0))
      B1=SQRT(1.0+0.5*(GAMA-1.0)*RM*RM)
      CFO=GAMA*RM*((2.0/(GAMA+1.0))**A1)/B1
      PCPT=(0.5*(GAMA+1.0))**(GAMA/(GAMA-1.0))
      VT=1.0+0.5*(GAMA-1.0)*RM*RM
      VT=GAMA*R*TE*VT/(0.5*(GAMA+1.0))
      VT=VT*G
      VT=SQRT(VT)
      SPIM=(1.0-PCPT*PAPC)/GAMA
      SPIM=1.0+SPIM
      SUMIM=VT*SIN(DELTA)*SPIM/G
      VACIM=1.0+1.0/GAMA
      SUMVA=VT*SIN(DELTA)*VACIM/G
      PRINT 15
15    FORMAT(1HK,5HDELTA,9X,5HHT/RE,9X,5HCFOPT)
      PRINT 16,DELTA,HT,CFO
16    FORMAT(1HK,3E 14.7)
      XN=N
      DRM=(RM-1.0)/XN
      XM=1.0
      K=1
      RXRE=1.0-HT*SIN(DELTA)
      XXRE=(-HT)*COS(DELTA)
      IF(GAS)38,39,39
38    DO 37 J=1,NJ
        I=J
        IF(XM-HM(J))35,36,37
37    CONTINUE
36    GAMA=GAM(I)
      GO TO 39
35    GAMA=GAM(I-1)+(XM-HM(I-1))*(GAM(I)-GAM(I-1))/(HM(I)-HM(I-1))
39    A3=(-GAMA)/(GAMA-1.0)
      PXPC=(1.0+0.5*(GAMA-1.0)*XM*XM)**A3
      PRINT 17
17    FORMAT(1HK,4HMACH,10X,5HRX/RE,9X,5HXX/RE,9X,5HPX/PC,9X,5HCFVAC,
     19X,3HSP.,1X,7HIMPULSE,3X,4HVAC.,1X,7HIMPULSE)
      GO TO 22
14    K=K+1
50    IF(GAS)41,40,40
41    DO 44 J=1,NT
        I=J
        IF(XM-HM(J))42,43,44
44    CONTINUE
43    GAMA=GAM(I)
      GO TO 40
42    GAMA=GAM(I-1)+(XM-HM(I-1))*(GAM(I)-GAM(I-1))/(HM(I)-HM(I-1))
40    A=SQRT((GAMA-1.0)*(XM*XM-1.0)/(GAMA+1.0))
      B=SQRT((GAMA+1.0)/(GAMA-1.0))
      C=SQRT(XM*XM-1.0)
      C=ATAN(C)
      VX=B*ATAN(A)-C
      Y=1.0/XM
      UX=ATAN(Y/SQRT(1.0-Y*Y))
      A2=(GAMA+1.0)/(2.0*(GAMA-1.))
      B2=(2.0/(GAMA+1.0))*(1.0+0.5*(GAMA-1.0)*XM*XM)
      RXRE=1.0-(B2**A2)*SIN(VE-VX+UX)/XP
      RXRE=SQRT(RXRE)
52    XXRE=(1.0-RXRE)*COS(VE-VX+UX)/SIN(VE-VX+UX)
      A3=(-GAMA)/(GAMA-1.0)
      PXPC=(1.0+0.5*(GAMA-1.0)*XM*XM)**A3
      SUMCG=SUMCG+0.5*XP*(PRO+PXPC)*(RXO*RXO-RXRE*RXRE)
      CO=PCPT*VT*XP/(G*GAMA)
      SUMIM=SUMIM+0.5*CO*(PRO+PXPC-2.0*PAPC)*(RXO*RXO-RXRE*RXRE)
      SUMVA=SUMVA+0.5*CO*(PRO+PXPC)*(RXO*RXO-RXRE*RXRE)
22    PRINT 18,XM,RXRE,XXRE,PXPC,SUMCG,SUMIM,SUMVA
18    FORMAT(1HK,7E14.7)
      IF(K-N)19,19,20
19    XM=XM+DRM
      PRO=PXPC
      GO TO 14
20    PRINT 21
21    FORMAT(1HK,8HEXTERNAL,1X,9HEXPANSION,1X,6HNOZZLE,1X,7HCONTOUR)
      GO TO 101
      END
